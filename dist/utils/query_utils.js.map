{"version":3,"sources":["../../src/utils/query_utils.js"],"names":["removeEmptyObjects","o","queryListFromRegex","field","regex","queryForTerm","$or","RegExp","term","fields","termToTermList","createSearchQuery","terms","$and","filterToQuery","filter","search","transformFilter","f","query","searchFields","searchTerm","sortPropsToMongoSort","sortAscending","pagePropertiesToLimitAndSkip","currentPage","pageSize","limit","skip","gridOptionsToQueryOptions","sortProperties","pageProperties","sort","limitAndSkip"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,IAAMA,qBAAqB,sBAAO;AAAA,SAAK,wBAASC,CAAT,KAAe,uBAAQA,CAAR,CAApB;AAAA,CAAP,CAA3B;;AAEA,IAAMC,qBAAqB,SAArBA,kBAAqB;AAAA,SAAS,oBAClC,mBAAI;AAAA,6CACDC,KADC,EACOC,KADP;AAAA,GAAJ,CADkC,CAAT;AAAA,CAA3B;AAKA,IAAMC,eAAe,SAAfA,YAAe;AAAA,SAAQ;AAAA,WAC3B;AACEC,WAAKJ,mBAAmB,IAAIK,MAAJ,CAAWC,IAAX,EAAiB,GAAjB,CAAnB,EAA0CC,MAA1C;AADP,KAD2B;AAAA,GAAR;AAAA,CAArB;AAKA,IAAMC,iBAAiB,oBAAK,qBAAM,GAAN,CAAL,EAAiB,kCAAjB,CAAvB;AACO,IAAMC,gDAAoB,SAApBA,iBAAoB,CAACF,MAAD,EAASG,KAAT;AAAA,SAC/B;AACEC,UAAM,mBAAI;AAAA,aAAQR,aAAaG,IAAb,EAAmBC,MAAnB,CAAR;AAAA,KAAJ,EAAwCG,KAAxC;AADR,GAD+B;AAAA,CAA1B;AAKP;AACO,IAAME,wCAAgB,SAAhBA,aAAgB,CAACC,MAAD,EAASC,MAAT,EAA8C;AAAA,MAA7BC,eAA6B,uEAAX;AAAA,WAAKC,CAAL;AAAA,GAAW;;AACzE;AACA;;AAEA;AACA,MAAMC,mCACD,CAAC,uBAAQJ,MAAR,CAAD,IAAoBf,mBAAmBiB,gBAAgBF,MAAhB,CAAnB,CADnB,EAEA,CAAC,uBAAQC,MAAR,CAAD,IAAoB,CAAC,uBAAQA,OAAOI,YAAf,CAArB,IAAqD,CAAC,uBAAQJ,OAAOK,UAAf,CAAtD,IACFV,kBAAkBK,OAAOI,YAAzB,EAAuCV,eAAeM,OAAOK,UAAtB,CAAvC,CAHE,CAAN;AAMA;AACA,SAAOF,KAAP;AACD,CAbM;;AAeA,IAAMG,sDAAuB,oBAClC,qBAAM,IAAN,CADkC,EAElC,yBAAU;AAAA,MAAGC,aAAH,SAAGA,aAAH;AAAA,SAAwBA,gBAAgB,CAAhB,GAAoB,CAAC,CAA7C;AAAA,CAAV,CAFkC,CAA7B;;AAKP,IAAMC,+BAA+B,SAA/BA,4BAA+B;AAAA,kFACP,EAAEC,aAAa,CAAf,EAAkBC,UAAU,EAA5B,EADO;AAAA,MACjCD,WADiC,SACjCA,WADiC;AAAA,MACpBC,QADoB,SACpBA,QADoB;;AAAA,SAE/B;AACJC,WAAOD,QADH;AAEJE,UAAM,CAACH,cAAc,CAAf,IAAoBC;AAFtB,GAF+B;AAAA,CAArC;AAMO,IAAMG,gEAA4B,SAA5BA,yBAA4B,QAAwC;AAAA,MAArCC,cAAqC,SAArCA,cAAqC;AAAA,MAArBC,cAAqB,SAArBA,cAAqB;;AAC/E;AACA,MAAMC,OAAOV,qBAAqBQ,cAArB,CAAb;AACA;AACA,MAAMG,eAAeT,6BAA6BO,cAA7B,CAArB;AACA;AACEC;AADF,KAEKC,YAFL;AAID,CATM","file":"query_utils.js","sourcesContent":["\nimport { omitBy, map, isObject, mapValues, keyBy, isEmpty, flow, split, trim } from 'lodash/fp';\n\n\nconst removeEmptyObjects = omitBy(o => isObject(o) && isEmpty(o));\n\nconst queryListFromRegex = regex => flow(\n  map(field => ({\n    [field]: regex,\n  })),\n);\nconst queryForTerm = term => fields => (\n  {\n    $or: queryListFromRegex(new RegExp(term, 'i'))(fields),\n  }\n);\nconst termToTermList = flow(split(' '), map(trim));\nexport const createSearchQuery = (fields, terms) => (\n  {\n    $and: map(term => queryForTerm(term)(fields))(terms),\n  }\n);\n/* eslint import/prefer-default-export: 0 */\nexport const filterToQuery = (filter, search, transformFilter = f => f) => {\n  // console.log('got filter', filter);\n  // console.log('got search', search);\n\n  // remove empty objects on filter\n  const query = {\n    ...!isEmpty(filter) && removeEmptyObjects(transformFilter(filter)),\n    ...(!isEmpty(search) && !isEmpty(search.searchFields) && !isEmpty(search.searchTerm) && (\n      createSearchQuery(search.searchFields, termToTermList(search.searchTerm))\n    )),\n  };\n  // console.log('query is', query);\n  return query;\n};\n\nexport const sortPropsToMongoSort = flow(\n  keyBy('id'),\n  mapValues(({ sortAscending }) => (sortAscending ? 1 : -1)),\n);\n\nconst pagePropertiesToLimitAndSkip = (\n  { currentPage, pageSize } = { currentPage: 1, pageSize: 10 },\n) => ({\n  limit: pageSize,\n  skip: (currentPage - 1) * pageSize,\n});\nexport const gridOptionsToQueryOptions = ({ sortProperties, pageProperties }) => {\n  // console.log('got sortProperties', sortProperties);\n  const sort = sortPropsToMongoSort(sortProperties);\n  // console.log('mongo sort', sort);\n  const limitAndSkip = pagePropertiesToLimitAndSkip(pageProperties);\n  return {\n    sort,\n    ...limitAndSkip,\n  };\n};\n"]}